#!/bin/sh

# bin/test: Do everything related to testing

set -e

cd "$(dirname "$0")/.."

export NODE_ENV="test"

echo "==> Linting..."
./node_modules/.bin/eslint .
echo "==> Done!"

if [ -z "$TRAVIS_DB_NAME" ]; then
echo "==> Creating test database"
createdb challenges_test
fi

echo "==> Running latest migrations"
cd db
./../node_modules/.bin/db-migrate up -e test
cd ..

echo "==> Loading test data"
node db/test.js

echo "==> Running tests..."
./node_modules/.bin/jasmine

if [ -z "$TRAVIS_DB_NAME"]; then
echo "==> Dropping test database"
dropdb challenges_test
fi

echo "==> All done!"
