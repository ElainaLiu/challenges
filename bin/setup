#!/bin/sh

# bin/setup: Set up application for the first time after cloning, or set it
#               back to the initial first unused state.

set -e

cd "$(dirname "$0")/.."

if [ -f "Brewfile" ] && [ "$(uname -s)" = "Darwin" ]; then
  brew update
  brew tap homebrew/bundle 2>/dev/null
fi

if [ -f "Brewfile" ] && [ "$(uname -s)" = "Darwin" ]; then
  brew bundle check 2>&1 >/dev/null || {
    echo "==> Installing Homebrew dependenciesâ€¦"
    brew bundle
  }
fi

echo "==> Installing node modules"
npm install

if psql -lqt | cut -d \| -f 1 | grep -w challenges_dev; then
  echo "Database already exists"
else
  echo "===> Setting up DB..."
  createdb challenges_dev
fi

npm run seed
echo "==> App is now ready to go!"
